<?xml version="1.0" encoding="UTF-8" ?>
<robot name="right_hand" xmlns:xacro="http://ros.org/wiki/xacro">

  <xacro:include filename="$(find sobit_mini_description)/urdf/right_hand/right_hand.transmission.xacro" />

  <xacro:macro name="right_hand" params="prefix parent">

    <joint name="${prefix}_joint" type="revolute">
      <parent link="${parent}" />
      <child link="${prefix}_left_finger_link" />
      <origin rpy="${-M_PI/2.0} ${M_PI/2.0} 0" xyz="0.0 -0.04725 -0.015855" />
      <axis xyz="0 -1 0" />
      <limit lower="0" upper="1" effort="30" velocity="${M_PI/2.0}" />
    </joint>

    <link name="${prefix}_left_finger_link">
      <visual>
        <origin xyz="0.0 0.0 0.0" rpy="${M_PI/2.0} 0.0 0.0" />
        <geometry>
          <mesh filename="package://sobit_mini_description/meshes/R_hand/R_hand_finger_l_joint.stl" />
        </geometry>
        <material name="black" />
      </visual>

      <collision>
        <origin xyz="0.016 0.0 -0.1" rpy="${M_PI/2.0} ${M_PI/2.0} 0.0" />
        <geometry>
          <box size="0.15 0.017 0.054"/>
        </geometry>
      </collision>

      <inertial>
        <origin xyz="0.013 0.0 -0.087" rpy="${M_PI/2.0} 0.0 0.0" />
        <mass value="0.12300634" />
        <inertia ixx="${1/12*0.12300634*(0.054**2 + 0.192**2)}" ixy="0.0" ixz="0.0" 
                 iyy="${1/12*0.12300634*(0.017**2 + 0.054**2)}" iyz="0.0" 
                 izz="${1/12*0.12300634*(0.017**2 + 0.192**2)}" />
      </inertial>
    </link>



    <joint name="${prefix}_right_finger_joint" type="revolute">
      <parent link="${parent}" />
      <child link="${prefix}_right_finger_link" />
      <origin rpy="${-M_PI/2.0} ${M_PI/2.0} 0" xyz="0.0 -0.04725 0.015855" />
      <axis xyz="0 1 0" />
      <limit lower="0.0" upper="1.0" effort="30" velocity="${M_PI/2.0}" />
      <mimic joint="${prefix}_joint" multiplier="1.0" />
    </joint>

    <link name="${prefix}_right_finger_link">
      <visual>
        <origin xyz="0.0 0.0 0.0" rpy="${M_PI/2.0} 0.0 0.0" />
        <geometry>
          <mesh filename="package://sobit_mini_description/meshes/R_hand/R_hand_finger_r_joint.stl" />
        </geometry>
        <material name="black" />
      </visual>

      <collision>
        <origin xyz="-0.016 0.0 -0.1" rpy="${M_PI/2.0} ${M_PI/2.0} 0.0" />
        <geometry>
          <box size="0.15 0.017 0.054"/>
        </geometry>
      </collision>

      <inertial>
        <origin xyz="-0.013 0.0 -0.087" rpy="${M_PI/2.0} 0.0 0.0" />
        <mass value="0.12312845" />
        <inertia ixx="${1/12*0.12300634*(0.054**2 + 0.192**2)}" ixy="0.0" ixz="0.0" 
                 iyy="${1/12*0.12300634*(0.017**2 + 0.054**2)}" iyz="0.0" 
                 izz="${1/12*0.12300634*(0.017**2 + 0.192**2)}" />
      </inertial>
    </link>


    <!--plug-in to distribute joint condition data-->
    <gazebo>
      <plugin name="joint_state_publisher" filename="libgazebo_ros_joint_state_publisher.so">
        <robotNamespace>/</robotNamespace>
        <jointName>${prefix}_joint</jointName>
      </plugin>
    </gazebo>

    <!-- the following is the template to mimic a joint -->
    <xacro:macro name="mimic_joint_plugin" params="name_prefix parent_joint mimic_joint has_pid:=false multiplier:=1.0 offset:=0 sensitiveness:=0.0 max_effort:=1.0 robot_namespace:=''">
      <gazebo>
        <plugin name="${name_prefix}mimic_joint_plugin" filename="libroboticsgroup_upatras_gazebo_mimic_joint_plugin.so">
          <joint>${parent_joint}</joint>
          <mimicJoint>${mimic_joint}</mimicJoint>
          <xacro:if value="${has_pid}">                     <!-- if set to true, PID parameters from "/gazebo_ros_control/pid_gains/${mimic_joint}" are loaded -->
            <hasPID />
          </xacro:if>
          <multiplier>${multiplier}</multiplier>
          <offset>${offset}</offset>
          <sensitiveness>${sensitiveness}</sensitiveness>   <!-- if absolute difference between setpoint and process value is below this threshold, do nothing; 0.0 = disable [rad] -->
          <maxEffort>${max_effort}</maxEffort>              <!-- only taken into account if has_pid:=true [Nm] -->
          <xacro:unless value="${robot_namespace == ''}">
            <robotNamespace>${robot_namespace}</robotNamespace>
          </xacro:unless>
        </plugin>
      </gazebo>
    </xacro:macro>

    <xacro:mimic_joint_plugin name_prefix="${prefix}_joint"
    parent_joint="${prefix}_joint" mimic_joint="${prefix}_right_finger_joint"
    has_pid="false" multiplier="1.0" max_effort="1.0" />

    <gazebo reference="${prefix}_right_finger_link">
      <material>Gazebo/Black</material>
    </gazebo>
    <gazebo reference="${prefix}_left_finger_link">
      <material>Gazebo/Black</material>
    </gazebo>

    <xacro:r_hand_transmission prefix="${prefix}"/>

  </xacro:macro>
</robot>